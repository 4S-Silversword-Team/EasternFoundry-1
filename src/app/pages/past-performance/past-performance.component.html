<div class="container" *ngIf='!this.promiseFinished'>
  <div class="loader"></div>
  <!-- <p class="loading">Loading</p> -->
</div>
<div class="page" *ngIf='this.promiseFinished'>
  <div class="edit-box">
    <div *ngIf="this.isUserAdmin" class="btn-edit" (click) = 'editPastPerformance()'>Edit</div>
  </div>
  <div class="container">
    <div class="basic-info col-xs-12">
      <div class="" style="height: 150px; width: 180px; position: relative; float: left;">
        <div class="left avatar">
          <img src='{{ this.currentPastPerformance.avatar }}' class="avatar-img">
        </div>
      </div>
      <div class="basic-info-top">
        <div class="" style="width: 100%; height: 150px;">
          <div class="col-xs-12 basic-info-header">
            <p>{{ this.currentPastPerformance.title }}</p>
          </div>
          <div class="col-xs-12 basic-info-sub">
            <p>{{this.currentPastPerformance.client.name}}</p>
          </div>
          <div class="col-xs-12 basic-info-sub-2">
            <p>{{this.currentPastPerformance.topic}}</p>
          </div>
        </div>
      </div>
      <div class="profile-top-bar">
        <div class="profile-navbar">
          <div class="profile-navbar-tab" (click)='switchTab(0)' [ngClass]="{'profile-navbar-tab-active': this.activeTab.main == 0}">
            Summary
          </div>
          <div class="profile-navbar-tab" (click)='switchTab(1)' [ngClass]="{'profile-navbar-tab-active': this.activeTab.main == 1}">
            Team
          </div>
          <div class="profile-navbar-tab" (click)='switchTab(2)' [ngClass]="{'profile-navbar-tab-active': this.activeTab.main == 2}">
            Descriptions
          </div>
        </div>
      </div>
      <div class="" style="width: 100%; height: 8px; border-bottom: 1px solid rgba(0,0,0,0.4)">
      </div>
    </div>
  </div>
  <div class="" style="width: 100%; margin-top: 8px; height: calc(99vh - 254px);">
    <!-- PROFILE TAB -->
    <div class="container" *ngIf='this.activeTab.main == 0'>
      <div class="basic-info-bottom">
        <div id="user-contact" class="col-xs-5 scrollbar" style="overflow-y: auto; height: 100%; padding-top: .1v; padding-bottom: .1v; border-right: 2px solid rgba(0,0,0,0.25);">
          <div class="" style="width: 100%;">
            <p class="basic-info-text-2">{{this.currentPastPerformance.startDate}} - {{this.currentPastPerformance.endDate}}</p>
            <p class="basic-info-text-2" *ngIf='this.currentPastPerformance.cleared'>Cleared</p>
            <p class="basic-info-text-2">Location: {{ this.currentPastPerformance.location }}</p>
            <p class="basic-info-text-2">Value: {{ this.currentPastPerformance.value }}</p>
            <p class="basic-info-text-2">FTE: {{ this.currentPastPerformance.fte }}</p>
          </div>
          <div style="width: 100%; margin-top: 20px;">
            <!-- <p class="basic-info-text-2">{{ this.currentPastPerformance.education[0].DegreeType[0].Name }}</p>
            <p class="basic-info-text-2">{{ this.currentPastPerformance.education[0].MajorProgramName[0] }}, {{ this.currentPastPerformance.education[0].School }}</p>
            <p class="basic-info-text-2">{{ this.currentPastPerformance.education[0].AttendanceEndDate.slice(0,4) }}</p> -->
          </div>
        </div>
        <div id="user-contact" class="col-xs-7 scrollbar" style="overflow-y: auto; padding-top: .1vh; height: 100%;">
          <div class="basic-info-career-panel" style="width: 100%; height: auto;">
            <div class="basic-info-text-2">
              <div class="left">
                <p>Produced by {{ this.currentPastPerformance.companyProxies[0].company.name }}</p>
                <p>By a team of {{this.currentPastPerformance.userProfileProxies.length}}</p>
              </div>
              <div class="right">
                <!-- {{p.StartDate.slice(0,4)}} - {{p.EndDate.slice(0,4)}} -->
              </div>
            </div><br>
            <!-- <p class="basic-info-text-2 left">{{ p.PositionTitle }}</p>
            <p class="basic-info-text-2 left" style="margin-bottom: 20px;">{{ p.Description.slice(0,50) }}...</p> -->
          </div>
            <!-- <div class="col-xs-12 basic-info-text" style="margin-top: 2px"><p class=" basic-info-text-2">{{ this.currentUser.phone[0].Number }}</p></div>
            <div class="col-xs-12 basic-info-text-2" style="margin-top: -10px">
            <rating [(ngModel)]="this.currentUser.informationAccuracy" [max]="5" style="margin-left: 25%"></rating>
            <p class="noWrapScroll" style="margin-top: -25px; font-size: 12px; text-align: center">Updated {{ this.currentUser.lastUpdated}}</p>
          </div> -->
        </div>
      </div>
      <div class="col-xs-12" style="background: rgba(223,223,225,1); height: calc(55vh - 127px); border-bottom: 0px solid black">
        <div id="service_chart"  style="height: calc(55vh - 127px); margin: 0 auto" [chart]="serviceChart"></div>
      </div>
    </div>
    <!-- TEAM TAB -->
    <div class="container" *ngIf='this.activeTab.main == 1'>
      <div class="team col-xs-12 clear">
        <div class="" *ngIf="this.currentPastPerformance.companyProxies">
          <div class="col-xs-12 left" *ngIf="this.currentPastPerformance.companyProxies[0].company" style="height: 180px; position: relative;">
            <div class="" style="height: 180px; width: 180px; position: relative; float: left;">
              <div class="left avatar">
                <img src='{{ this.currentPastPerformance.companyProxies[0].company.avatar }}' class="avatar-img">
              </div>
            </div>
            <div class="" style="position: absolute; height: 180px; width: calc(100% - 180px); padding-top: 40px; bottom: 0px; right: 0px; float: left; background: none;">
              <a href="corporate-profile/{{this.currentPastPerformance.companyProxies[0].company._id}}">
                <div class="col-xs-12 basic-info-header" style="padding-top: 6px">
                  <p style="white-space: nowrap">{{ this.currentPastPerformance.companyProxies[0].company.name }}</p>
                </div>
              </a>
              <div class="col-xs-12 basic-info-sub" style="padding-top: 6px">
                <p>{{this.percentAffiliated}}% still affiliated</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="employees col-xs-12 clear">
        <div class="col-xs-12 div-title" style="margin-top: 0px;">
          <p class="">Team Members:</p>
        </div>
        <div class="employees-navbar">
          <div class="employees-navbar-tab" (click)='activeTab.employees = 0' [ngClass]="{'employees-navbar-tab-active': this.activeTab.employees == 0}">
            Still Affiliated
          </div>
          <div class="employees-navbar-tab-right" (click)='activeTab.employees = 1' [ngClass]="{'employees-navbar-tab-active-right': this.activeTab.employees == 1}">
            No Longer Affiliated
          </div>
        </div>
        <div class="employees-inner">
          <div class="" *ngIf='this.currentPastPerformance.userProfileProxies'>
            <div class="" *ngFor='let index of this.currentPastPerformance.userProfileProxies'>
              <div class="" *ngIf='index.user'>
                <div class="employee-panel col-xs-12 col-md-6 left" *ngIf='activeTab.employees == 0 && index.stillAffiliated && index.user.public'>
                  <div class="left avatar-small">
                    <img src='{{ index.user.avatar }}' class="avatar-img-small">
                  </div>
                  <p class="">{{ index.user.firstName + ' ' + index.user.lastName}}</p>
                  <p *ngIf="index.user.positionHistory[0]" class="">{{ index.user.positionHistory[0].PositionTitle }}</p>
                  <p class="">{{ index.user.username }}</p>
                  <a href="/user-profile/{{index.user._id}}">
                    <button class="employee-link">
                      More<br>Info
                    </button>
                  </a>
                </div>
                <div class="employee-panel col-xs-12 col-md-6 left" *ngIf='activeTab.employees == 1 && !index.stillAffiliated && index.user.public'>
                  <div class="left avatar-small">
                    <img src='{{ index.user.avatar }}' class="avatar-img-small">
                  </div>
                  <p class="">{{ index.user.firstName + ' ' + index.user.lastName}}</p>
                  <p *ngIf="index.user.positionHistory[0]" class="">{{ index.user.positionHistory[0].PositionTitle }}</p>
                  <p class="">{{ index.user.username }}</p>
                  <a href="/user-profile/{{index.user._id}}">
                    <button class="employee-link">
                      More<br>Info
                    </button>
                  </a>
                </div>
              </div>
            </div>
            <div class="employee-panel col-xs-12 col-md-6 left" *ngIf='activeTab.employees == 0 && privateCount.affiliated > 0'>
              <p class="" *ngIf='privateCount.affiliated == 1'>{{ privateCount.affiliated }} Private Employee</p>
              <p class="" *ngIf='privateCount.affiliated > 1'>{{ privateCount.affiliated }} Private Employees</p>
            </div>
            <div class="employee-panel col-xs-12 col-md-6 left" *ngIf='activeTab.employees == 1 && privateCount.notAffiliated > 0'>
              <p class="" *ngIf='privateCount.notAffiliated == 1'>{{ privateCount.notAffiliated }} Private Employee</p>
              <p class="" *ngIf='privateCount.notAffiliated > 1'>{{ privateCount.notAffiliated }} Private Employees</p>
            </div>
          </div>
        </div>
        <div class="" *ngIf="!this.currentPastPerformance.userProfileProxies" class="main clear">
           No employees to show
        </div>
        <div class="" *ngIf="this.currentPastPerformance.userProfileProxies">
          <div *ngIf="!this.currentPastPerformance.userProfileProxies[0]" class="main clear">No employees to show</div>
        </div>
      </div>
    </div>
    <div class="container scrollbar" *ngIf='this.activeTab.main == 2'>
      <div class="text-container scrollbar" style="height: calc(29vh - 74px); width: 100%; float: left; margin-top: 1vh">
        <p class="col-xs-12 fs-16 lh-20">Synopsis</p>
        <textarea class="scrollbar" readonly>{{ currentPastPerformance.synopsis }}</textarea>
      </div>
      <div class="text-container scrollbar" style="height: calc(32.5vh - 73px); width: calc(50% - 0.5vw); float: left; margin-right: 0.5vw;">
        <p class="col-xs-12 fs-16 lh-20">Technical Challenge, approach and outcome</p>
        <textarea class="scrollbar" readonly>{{ currentPastPerformance.technical }}</textarea>
      </div>
      <div class="text-container scrollbar" style="height: calc(32.5vh - 73px); width: calc(50% - 0.5vw); float: left; margin-left: 0.5vw;">
        <p class="col-xs-12 fs-16 lh-20">Management Challenge, approach and outcome</p>
        <textarea class="scrollbar" readonly>{{ currentPastPerformance.management }}</textarea>
      </div>
      <div class="text-container scrollbar" style="height: calc(29vh - 74px); margin-bottom: 0px; width: 100%; float: left;">
        <p class="col-xs-12 fs-16 lh-20">Other</p>
        <textarea class="scrollbar" readonly>{{ currentPastPerformance.other }}</textarea>
      </div>
    </div>
</div>
