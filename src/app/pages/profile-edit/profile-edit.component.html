<div class="container" *ngIf='!this.promiseFinished'>
  <div class="loader"></div>
  <!-- <p class="loading">Loading</p> -->
</div>
<div class="not-finished-alert" *ngIf='!this.currentUser.finished && this.promiseFinished'>Fill in the empty fields to complete your user profile!</div>
<div class="container" *ngIf='this.promiseFinished'>
  <div class="btn-back" (click) = 'this.location.back()'></div>
  <div class="basic-info col-xs-10 col-xs-offset-1 clear">
    <div class="row">
      <div class="col-xs-8 col-lg-2 col-lg-offset-0" [style.height] = "'150px'">
        <img *ngIf="this.currentUser.avatar" src="{{this.currentUser.avatar}}" class="avatar left">
        <div *ngIf="!this.currentUser.avatar || this.currentUser.avatar.startsWith('..')" class="left">
        <input type="file" #fileInput accept=".jpg,.png" style="width:100%"/>
        <button class="btn btn-primary" (click)="uploadPhoto()">Upload Avatar</button>
        </div>
        <div *ngIf="this.currentUser.avatar && !this.currentUser.avatar.startsWith('..')" class="left">
          <input type="file" #fileInput accept=".jpg,.png" style="width:100%"/>
          <button class="btn btn-primary" (click)="editPhoto()">Edit Avatar</button>
        </div>
      </div>
      <div id="20" class="col-xs-10 col-xs-offset-4 col-lg-5 col-lg-offset-0" *ngIf = this.promiseFinished>
        <p class="col-xs-4 text-right vertically-centered">First Name</p>
        <input class="col-xs-8 left" type="text" placeholder="Your first name" [(ngModel)] = 'this.currentUser.firstName' (ngModelChange)="checkFields()" [ngClass]="{'empty-field': !this.currentUser.firstName}">
        <p class="col-xs-4 text-right vertically-centered">Last Name</p>
        <input class="col-xs-8 left" type="text" placeholder="Your last name" [(ngModel)] = 'this.currentUser.lastName' (ngModelChange)="checkFields()" [ngClass]="{'empty-field': !this.currentUser.lastName}">
        <p class="col-xs-4 text-right vertically-centered">Title</p>
        <input class="col-xs-8 left" type="text" placeholder="Your current job title" [(ngModel)] = 'this.currentUser.positionHistory[0].PositionTitle' (ngModelChange)="checkFields()" [ngClass]="{'empty-field': !this.currentUser.positionHistory[0].PositionTitle}">
        <p class="col-xs-4 text-right vertically-centered">Employer</p>
        <input class="col-xs-8 left" type="text" placeholder="Your current employer" [(ngModel)] = 'this.currentUser.positionHistory[0].Employer' (ngModelChange)="checkFields()" [ngClass]="{'empty-field': !this.currentUser.positionHistory[0].Employer}">
      </div>
      <!--<div><img src="../assets/img/glyphicon/phone-2.png" class="left"><p class="left">{{ this.currentUser.contactNumber }}</p></div>-->
      <!--<div><img src="../assets/img/glyphicon/post-1.png" class="left"><p class="left">{{ this.currentUser.city }}</p></div>-->

      <div id="user-contact" class="col-xs-2 col-xs-offset-1 col-lg-1 col-lg-offset-0" style="margin-right: 0px">
        <div class="col-xs-12 left"><img style="height: 75%; transform: translateY(-5%)" src="../assets/img/glyphicon/email-1.png"></div>
        <div class="col-xs-12 left"><img style="height: 75%; transform: translateY(-5%)" src="../assets/img/glyphicon/phone-2.png" class="left"></div>
        <div class="col-xs-12 left"><img style="height: 75%; transform: translateY(-25%)" src="../assets/img/glyphicon/post-1.png" class="left"></div>
      </div>
      <div id="user-contact" class="col-xs-8 col-lg-4 col-lg-offset-0" style="margin-left: 0px" *ngIf = this.promiseFinished>
        <p class="col-xs-3 text-right vertically-centered">Email</p>
        <input class="col-xs-9 left" type="email" [(ngModel)] = 'this.currentUser.username' (ngModelChange)="checkFields()" [ngClass]="{'empty-field': !this.currentUser.username}" disabled>

        <p class="col-xs-3 text-right" style="transform: translateY(10%)">Contact Number</p>
        <input class="col-xs-9 left" type="tel" maxlength="14" [(ngModel)] = 'this.currentUser.cell' (ngModelChange)="onPhoneChange(this.currentUser.cell); checkFields()" (keydown.backspace)='onPhoneChange(this.currentUser.cell, true)' [ngClass]="{'empty-field': !this.currentUser.cell || this.currentUser.cell.length < 14}">
        <p class="col-xs-3 text-right vertically-centered">City</p>
        <input class="col-xs-9 left" type="text"  [(ngModel)] = 'this.currentUser.address.city' (ngModelChange)="checkFields()" [ngClass]="{'empty-field': this.currentUser.address.city.length < 1}">

        <p class="col-xs-3 text-right vertically-centered">State</p>
        <input class="col-xs-9 left" type="text"  [(ngModel)] = 'this.currentUser.address.state' (ngModelChange)="checkFields()" [ngClass]="{'empty-field': !this.currentUser.address.state}">

        <p class="col-xs-3 text-right vertically-centered">Zip</p>
        <input class="col-xs-9 left" type="number" max="99999" maxlength="5" [(ngModel)] = 'this.currentUser.address.zip' (ngModelChange)="checkFields()" [ngClass]="{'empty-field': !this.currentUser.address.zip}">
      </div>
      <div class="col-xs-12">
        <p class="col-xs-6 text-right vertically-centered">Make your account publically viewable?</p>
        <input type="checkbox" class="col-xs-1" [(ngModel)] = 'this.currentUser.public'>
      </div>
    </div>
  </div>

  <div class="certification col-xs-12">
    <div class="div-title col-xs-12">
      <img src="./assets/img/profile/degree.png">
      <p>DEGREES</p>
      <div ></div>
    </div>
    <div class="col-xs-12 col-md-12 text-center">
        <div class="col-xs-12 text-left text-container" style="padding-bottom: 14em" [style.height] = "'260px'" *ngFor="let degree of this.currentUser.education; let i = index">
          <!-- <button class="tiny-button-job" (click)="deleteJob(i)" style="margin-right: 4px; margin-top: -22px"><img src="./assets/img/btn-close.png" alt="" class="tiny-button-job-text"></button> -->
          <div (click)='deleteDegree(i)' style="position: absolute; z-index: 4; right: 4px; top: 1px">
            <div class="">
              <img src="./assets/img/btn-close.png" alt="" class="close-x">
            </div>
          </div>
          <div class="col-xs-8 col-md-6">
            <p class="col-xs-6 col-md-5 vertically-centered">Type: </p>
            <select class="col-xs-6 col-md-7" name="" [(ngModel)] = 'degree.DegreeType[0].Name' (ngModelChange)="checkFields(); calculateProfessionalPoints()" [ngClass]="{'empty-field': !degree.DegreeType[0].Name}" style="margin-top: 12px; height: 32px">
              <option *ngFor='let d of this.degreeType' [value]='d.name'>{{d.name}}</option>
            </select>
            <!-- <input class="col-xs-6 col-md-7" [(ngModel)] = 'degree.DegreeType[0].Name'> -->
            <p class="col-xs-6 col-md-5 vertically-centered">Concentration: </p>
            <input class="col-xs-6 col-md-7" [(ngModel)] = 'degree.MajorProgramName' (ngModelChange)="checkFields()" [ngClass]="{'empty-field': !degree.MajorProgramName}">
            <p class="col-xs-6 col-md-5 vertically-centered">School: </p>
            <input class="col-xs-6 col-md-7" [(ngModel)] = 'degree.School' (ngModelChange)="checkFields()" [ngClass]="{'empty-field': !degree.School}">
            <p class="col-xs-6 col-md-5 vertically-centered">Graduation Date: </p>
            <input class="col-xs-6 col-md-7" [(ngModel)] = 'degree.AttendanceEndDate' (ngModelChange)="checkFields()" [ngClass]="{'empty-field': !degree.AttendanceEndDate}">
          </div>
          <div class="col-xs-4 col-md-6">
            <textarea name="" id="" rows="8" placeholder="Description:" [(ngModel)] = 'degree.Comment'></textarea>
          </div>
        </div>
        <div class="col-xs-8 col-xs-offset-2">
          <button class="col-xs-12 col-xs-offset-0 col-md-4 col-md-offset-4" (click)="addDegree()">Add Degree</button>
        </div>
    </div>
  </div>

  <div class="certification col-xs-12">
    <div class="div-title col-xs-12">
      <img src="./assets/img/profile/certificate.png">
      <p>CERTIFICATIONS</p>
      <div ></div>
    </div>
    <div class="col-xs-11 col-xs-offset-1">
        <p class="col-xs-4 text-left">Name</p>
        <p class="col-xs-4 text-left">Date Earned</p>
    </div>

    <div class="col-xs-11 col-xs-offset-1" type="text" *ngFor="let certificate of this.currentUser.certification; let i = index">
      <!-- <div class="col-xs-4">
        <input class="col-xs-11" type="text" [(ngModel)] = 'certificate.CertificationName' (ngModelChange)="checkFields()" [ngClass]="{'empty-field': !certificate.CertificationName}">
      </div> -->
      <div class="autocomplete-form col-xs-4">
        <input ngui-auto-complete class="col-xs-11" placeholder="Must match an existing certification" [(ngModel)] = 'certificate.CertificationName' [source]='this.allCerts' [list-formatter]="certListFormatter" display-property-name='name' select-value-of='name' auto-select-first-item='true' [ngClass]="{'empty-field': certValidCheck(certificate.CertificationName) == false}">
      </div>
      <div class="col-xs-4">
        <input class="col-xs-11" type="text" [(ngModel)] = 'certificate.DateEarned' (ngModelChange)="checkFields()" [ngClass]="{'empty-field': !certificate.DateEarned}">
      </div>
      <div class="col-xs-3 col-xs-offset-1" style="padding-top: 1%; height: 100%; margin-top: 20px">
        <button class="col-xs-12 side-button" style="height: 12%; margin-top: -24px" (click)="deleteCertificate(i)">DELETE</button>
      </div>
    </div>
    <div class="col-xs-8 col-xs-offset-2">
      <button class="col-xs-12 col-xs-offset-0 col-md-4 col-md-offset-4" (click)="addCertificate(); calculateProfessionalPoints()">Add Certificate</button>
    </div>
  </div>

  <div class="certification col-xs-12">
    <div class="div-title col-xs-12">
      <img src="./assets/img/profile/clearances.png">
      <p>CLEARANCES</p>
      <div ></div>
    </div>
    <div class="col-xs-12 text-center" *ngFor="let index of this.currentUser.clearance; let i = index">
      <div class="col-xs-10" style="padding-top: 2%">
        <div class="col-xs-4">
          <p class="col-xs-12 text-left">Type: </p>
          <input class="col-xs-12" [(ngModel)] = 'index.clearanceType' (ngModelChange)="checkFields()" [ngClass]="{'empty-field': !index.clearanceType}">
        </div>
        <div class="col-xs-4 text-left">
          <p class="col-xs-12">Awarded: </p>
          <input class="col-xs-12" [(ngModel)] = 'index.awarded' (ngModelChange)="checkFields()" [ngClass]="{'empty-field': !index.awarded}">
        </div>
        <div class="col-xs-4 text-left">
          <p class="col-xs-12">Expiration: </p>
          <input class="col-xs-12" [(ngModel)] = 'index.expiration' (ngModelChange)="checkFields()" [ngClass]="{'empty-field': !index.expiration}">
        </div>
      </div>
      <div class="col-xs-2" style="padding-top: 4%">
        <button class="col-xs-12" style="height: 12%; margin: 1%;" (click)="deleteClearance(i)">DELETE</button>
      </div>
    </div>
    <div class="col-xs-8 col-xs-offset-2">
      <button class="col-xs-12 col-xs-offset-0 col-md-4 col-md-offset-4" (click)="addClearance()">Add Clearance</button>
    </div>
  </div>

  <div class="certification col-xs-12">
    <div class="div-title col-xs-12">
      <img src="./assets/img/profile/awards.png">
      <p>AWARDS</p>
      <div ></div>
    </div>
    <div class="col-xs-12 text-center">
      <div class="col-xs-12" style="padding-top: 2%">
        <div class="col-xs-6 text-left" *ngFor="let award of this.currentUser.award; let i = index; trackBy:customTrackBy">
          <input class="col-xs-12" [(ngModel)] = 'this.currentUser.award[i]' (ngModelChange)="checkFields()" [ngClass]="{'empty-field': !this.currentUser.award[i]}">
          <button class="tiny-button-awards" (click)="deleteAward(i)"><div class="tiny-button-text">x</div></button>
        </div>
      </div>
    </div>
    <div class="col-xs-8 col-xs-offset-2" style="margin-top: 5px">
      <button class="col-xs-12 col-xs-offset-0 col-md-4 col-md-offset-4" (click)="addAward()">Add Award</button>
    </div>
  </div>

  <div class="career col-xs-12 clear">
    <div class="div-title col-xs-12">
      <img src="./assets/img/profile/career.png">
      <p>CAREER</p>
      <div ></div>
    </div>

    <div *ngFor="let job of this.currentUser.positionHistory; let i = index" class="col-xs-12 job text-container" style="margin: 1%">
      <div (click)='deleteJob(i)' style="position: absolute; z-index: 4; right: 4px; top: 1px">
        <div class="">
          <img src="./assets/img/btn-close.png" alt="" class="close-x">
        </div>
      </div>
      <div class="col-xs-12" style="margin-top: -15px">
        <div class="col-xs-4 job-tab" (click) = 'setEmployment(job, 0)'  [ngClass]="{'job-tab-active': job.employmentType == 0}">
          Government
          <!-- <div class="col-xs-6">
            <p style="text-align: right">Government</p>
          </div>
          <div class="col-xs-2" (click) = 'setEmployment(job, 0)' *ngIf='job.employmentType == 0' style='background: green; width: 20px; height: 20px'></div>
          <div class="col-xs-2" (click) = 'setEmployment(job, 0)' *ngIf='job.employmentType !== 0' style='background: red; width: 20px; height: 20px'></div> -->
        </div>
        <div class="col-xs-4 job-tab" (click) = 'setEmployment(job, 1)'  [ngClass]="{'job-tab-active': job.employmentType == 1}">
          Contractor
          <!-- <div class="col-xs-6">
            <p style="text-align: right">Contractor</p>
          </div>
          <div class="col-xs-2" (click) = 'setEmployment(job, 1)' *ngIf='job.employmentType == 1' style='background: green; width: 20px; height: 20px'></div>
          <div class="col-xs-2" (click) = 'setEmployment(job, 1)' *ngIf='job.employmentType !== 1' style='background: red; width: 20px; height: 20px'></div> -->
        </div>
        <div class="col-xs-4 job-tab" (click) = 'setEmployment(job, 2)'  [ngClass]="{'job-tab-active': job.employmentType == 2}">
          Commercial
          <!-- <div class="col-xs-6">
            <p style="text-align: right">Commercial</p>
          </div>
          <div class="col-xs-2" (click) = 'setEmployment(job, 2)' *ngIf='job.employmentType == 2' style='background: green; width: 20px; height: 20px'></div>
          <div class="col-xs-2" (click) = 'setEmployment(job, 2)' *ngIf='job.employmentType !== 2' style='background: red; width: 20px; height: 20px'></div> -->
        </div>
      </div>
      <div class="col-xs-12 job-interior">
        <div class="col-xs-5">
          <p class="col-xs-5 col-md-4 vertically-centered">Title</p>
          <input class="col-xs-7 col-md-8 left" placeholder="The title you held" [(ngModel)] = 'job.PositionTitle'>
          <p class="col-xs-5 col-md-4 vertically-centered">End Date</p>
          <input class="col-xs-7 col-md-8 left" placeholder="" [(ngModel)] = 'job.EndDate' (ngModelChange)='calculateProfessionalPoints()'>
          <p class="col-xs-5 col-md-4 vertically-centered">Start Date</p>
          <input class="col-xs-7 col-md-8 left" placeholder="" [(ngModel)] = 'job.StartDate' (ngModelChange)='calculateProfessionalPoints()'>
        </div>
        <div class="col-xs-7">
          <textarea class="col-xs-12 left" rows="9" placeholder="Description:" [(ngModel)] = 'job.Description'></textarea>
        </div>
        <!-- field for Government -->
        <div class="col-xs-12 col-md-10 col-md-offset-2" *ngIf = 'job.employmentType == 0'>
          <div class="col-xs-12">
            <p class="col-md-3 col-xs-5 vertically-centered">Employer (Agency)</p>
            <div class="autocomplete-form">
              <input ngui-auto-complete class="col-md-9 col-xs-7" placeholder="Must match an existing agency" [(ngModel)] = 'job.Employer' [source]='this.allAgencies' [list-formatter]="autocompleListFormatter" display-property-name='agency' select-value-of='agency' auto-select-first-item='true' [ngClass]="{'empty-field': agencyValidCheck(job.Employer) == false}">
            </div>
            <div class="col-xs-12" style="height: 60px">
              <p class="col-xs-4 col-md-3 col-xs-offset-1" style="margin-top: 15px">Were you a PM?</p>
              <input type="checkbox" class="col-xs-1" [(ngModel)] = 'job.agencyExperience[0].main.isPM' style="margin-top: 15px">
              <div class="col-xs-1" *ngIf='job.agencyExperience[0].main.isPM'>
                <div class="" style="text-align: left">Score:</div>
                <input type="number" min='1' max='5' name="" value="" [(ngModel)]='job.agencyExperience[0].main.pmScore'>
              </div>
              <div class="col-xs-5 col-md-6">
                <textarea class="left" rows="2" placeholder="Description:" [(ngModel)] = 'job.agencyExperience[0].main.pmDescription' *ngIf='job.agencyExperience[0].main.isPM' [ngClass]="{'empty-field': job.agencyExperience[0].main.pmScore >= 4 && job.agencyExperience[0].main.pmDescription.length < 300}"></textarea>
              </div>
            </div>
            <div class="col-xs-12" style="height: 60px; margin-bottom: 5px">
              <p class="col-xs-4 col-md-3 col-xs-offset-1" style="margin-top: 15px">Were you a warranted KO?</p>
              <input type="checkbox" class="col-xs-1" [(ngModel)] = 'job.agencyExperience[0].main.isKO' style="margin-top: 15px">
              <div class="col-xs-1" *ngIf='job.agencyExperience[0].main.isKO'>
                <div class="" style="text-align: left">Score:</div>
                <input type="number" min='1' max='5' name="" value="" [(ngModel)]='job.agencyExperience[0].main.koScore'>
              </div>
              <div class="col-xs-5 col-md-6">
                <textarea class="left" rows="2" placeholder="Description:" [(ngModel)] = 'job.agencyExperience[0].main.koDescription' *ngIf='job.agencyExperience[0].main.isKO' [ngClass]="{'empty-field': job.agencyExperience[0].main.koScore >= 4 && job.agencyExperience[0].main.koDescription.length < 300}"></textarea>
              </div>
            </div>
            <div class="" *ngIf='job.agencyExperience[0].offices.length < 1'>
              <p class="col-xs-8 vertically-centered" style="text-align: right">Did you work for a subagency?</p>
              <button class="col-xs-4" (click)="addOffice(job.agencyExperience[0])">Yes</button>
            </div>
            <div class="col-xs-12" *ngIf='job.agencyExperience[0].offices.length > 0' style="position: relative">
              <p class="col-md-3 col-xs-5 col-xs-offset-1 vertically-centered">Employer (Subagency)</p>
              <div class="autocomplete-form">
                <input ngui-auto-complete class="col-md-8 col-xs-6" placeholder="Must match an existing subagency" [(ngModel)] = 'job.agencyExperience[0].offices[0].title' [source]='findSubAgencies(job.Employer)'  auto-select-first-item='true' [ngClass]="{'empty-field': subagencyValidCheck(job.Employer, job.agencyExperience[0].offices[0].title) == false}">
              </div>
              <button class="tiny-button-skills" (click)="deleteOffice(job.agencyExperience[0], 0)" style="margin-top: 177px; margin-right: -5px"><div class="tiny-button-text">x</div></button>
              <div class="col-xs-12" style="height: 60px">
                <p class="col-xs-4 col-md-3 col-xs-offset-1" style="margin-top: 15px">Were you a PM?</p>
                <input type="checkbox" class="col-xs-1" [(ngModel)] = 'job.agencyExperience[0].offices[0].isPM' style="margin-top: 15px">
                <div class="col-xs-1" *ngIf='job.agencyExperience[0].offices[0].isPM'>
                  <div class="" style="text-align: left">Score:</div>
                  <input type="number" min='1' max='5' name="" value="" [(ngModel)]='job.agencyExperience[0].offices[0].pmScore'>
                </div>
                <div class="col-xs-5 col-md-6">
                  <textarea class="left" rows="2" placeholder="Description:" [(ngModel)] = 'job.agencyExperience[0].offices[0].pmDescription' *ngIf='job.agencyExperience[0].offices[0].isPM' [ngClass]="{'empty-field': job.agencyExperience[0].offices[0].pmScore >= 4 && job.agencyExperience[0].offices[0].pmDescription.length < 300}"></textarea>
                </div>
              </div>
              <div class="col-xs-12" style="height: 60px; margin-bottom: 5px">
                <p class="col-xs-4 col-md-3 col-xs-offset-1" style="margin-top: 15px">Were you a warranted KO?</p>
                <input type="checkbox" class="col-xs-1" [(ngModel)] = 'job.agencyExperience[0].offices[0].isKO' style="margin-top: 15px">
                <div class="col-xs-1" *ngIf='job.agencyExperience[0].offices[0].isKO'>
                  <div class="" style="text-align: left">Score:</div>
                  <input type="number" min='1' max='5' name="" value="" [(ngModel)]='job.agencyExperience[0].offices[0].koScore'>
                </div>
                <div class="col-xs-5 col-md-6">
                  <textarea class="left" rows="2" placeholder="Description:" [(ngModel)] = 'job.agencyExperience[0].offices[0].koDescription' *ngIf='job.agencyExperience[0].offices[0].isKO' [ngClass]="{'empty-field': job.agencyExperience[0].offices[0].koScore >= 4 && job.agencyExperience[0].offices[0].koDescription.length < 300}"></textarea>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xs-11 col-xs-offset-1" *ngIf='job.agencyExperience.length < 1'>
            <p class="col-xs-8 vertically-centered" style="text-align: right">Did you work with any other govt agencies?</p>
            <button class="col-xs-4" (click)="addAgency(job)">Yes</button>
          </div>
          <div class="col-xs-11 col-xs-offset-1" *ngFor="let agency of job.agencyExperience; let i = index; trackBy:customTrackBy">
            <div class="" *ngIf='i > 0' style="margin-bottom: 25px">
              <div class="">
                <p class="col-md-3 col-xs-5 vertically-centered">Agency {{i + 1}}</p>
                <input class="col-md-9 col-xs-7" [(ngModel)] = 'agency.main.title'>
                <button class="tiny-button-skills" (click)="deleteAgency(job, i)" style="margin-top: 9px; margin-right: -5px"><div class="tiny-button-text">x</div></button>
              </div>
              <div class="col-xs-12" style="height: 50px">
                <p class="col-xs-4 col-md-3 xs-offset-1" style="margin-top: 15px">Were you a PM?</p>
                <input type="checkbox" class="col-xs-1" [(ngModel)] = 'agency.main.isPM' style="margin-top: 15px">
                <div class="col-xs-1" *ngIf='agency.main.isPM'>
                  <div class="" style="text-align: left">Score:</div>
                  <input type="number" min='1' max='5' name="" value="" [(ngModel)]='agency.main.pmScore'>
                </div>
                <div class="col-xs-5 col-md-6">
                  <textarea class="left" rows="2" placeholder="Description:" [(ngModel)] = 'agency.main.pmDescription' *ngIf='agency.main.isPM' [ngClass]="{'empty-field': agency.main.pmScore >= 4 && agency.main.pmDescription.length < 300}"></textarea>
                </div>
              </div>
              <div class="col-xs-12" style="height: 50px" style="margin-bottom: 5px">
                <p class="col-xs-4 col-md-3  col-xs-offset-1" style="margin-top: 15px">Were you a warranted KO?</p>
                <input type="checkbox" class="col-xs-1" [(ngModel)] = 'agency.main.isKO' style="margin-top: 15px">
                <div class="col-xs-1" *ngIf='agency.main.isKO'>
                  <div class="" style="text-align: left">Score:</div>
                  <input type="number" min='1' max='5' name="" value="" [(ngModel)]='agency.main.koScore'>
                </div>
                <div class="col-xs-5 col-md-6">
                  <textarea class="left" rows="2" placeholder="Description:" [(ngModel)] = 'agency.main.koDescription' *ngIf='agency.main.isKO' [ngClass]="{'empty-field': agency.main.koScore >= 4 && agency.main.koDescription.length < 300}"></textarea>
                </div>
              </div>
              <div class="" *ngIf='agency.offices.length < 1'>
                <p class="col-xs-8 vertically-centered" style="text-align: right">Did you work for a subagency?</p>
                <button class="col-xs-4" (click)="addOffice(agency)">Yes</button>
              </div>
              <div class="" *ngIf='agency.offices.length > 0'>
                <div class="" *ngFor='let office of agency.offices; let i = index; trackBy:customTrackBy'>
                  <p class="col-md-3 col-xs-5 col-xs-offset-1 vertically-centered">Subagency</p>
                  <div class="autocomplete-form">
                    <input ngui-auto-complete class="col-md-8 col-xs-6" placeholder="Must match an existing subagency" [(ngModel)] = 'office.title' [source]='findSubAgencies(agency.main.title)' auto-select-first-item='true' [ngClass]="{'empty-field': subagencyValidCheck(agency.agency, office.title) == false}">
                  </div>
                  <!-- <input class="col-md-8 col-xs-6" [(ngModel)] = 'office.title'> -->
                  <!-- BUG: if you have multiple agencies, the button only appears on the topmost one and deletes the bottommost one -->
                  <button class="tiny-button-skills" (click)="deleteOffice(agency, i)" style="margin-top: 51px; margin-right: -5px"><div class="tiny-button-text">x</div></button>
                </div>
                <button class="col-xs-4 col-xs-offset-8" (click)="addOffice(agency)">Add Subagency</button>
              </div>
            </div>
          </div>
          <div class="col-xs-11 col-xs-offset-1" *ngIf='job.agencyExperience.length > 1'>
            <button class="col-xs-6 col-xs-offset-6" (click)="addAgency(job)">Add Agency</button>
          </div>
        </div>

        <!-- field for Contractor -->
        <div class="col-xs-12 col-md-10 col-md-offset-2" *ngIf = 'job.employmentType > 0'>
          <div class="col-xs-12">
            <p class="col-xs-2 vertically-centered">Employer</p>
            <input class="col-xs-10" [(ngModel)] = 'job.Employer'>
          </div>
          <div class="" *ngIf='job.employmentType == 1'>
            <div class="col-xs-11 col-xs-offset-1" *ngIf='job.agencyExperience.length < 1'>
              <p class="col-xs-8 vertically-centered" style="text-align: right">Did you work with any govt agencies?</p>
              <button class="col-xs-4" (click)="addAgency(job)">Yes</button>
            </div>
            <div class="col-xs-11 col-xs-offset-1 col-md-11 col-md-offset-1" *ngFor="let agency of job.agencyExperience; let i = index; trackBy:customTrackBy">
              <div class="">
                <div class="">
                  <p class="col-md-3 col-xs-5 vertically-centered">Agency {{i}}</p>
                  <div class="autocomplete-form">
                    <input ngui-auto-complete class="col-md-9 col-xs-7" placeholder="Must match an existing agency" [(ngModel)] = 'agency.main.title' [source]='this.allAgencies' [list-formatter]="autocompleListFormatter" display-property-name='agency' select-value-of='agency' auto-select-first-item='true' [ngClass]="{'empty-field': agencyValidCheck(agency.main.title) == false}">
                  </div>
                  <!-- <input class="col-md-9 col-xs-7" [(ngModel)] = 'agency.main.title'> -->
                  <div class="col-xs-12" style="height: 50px">
                    <p class="col-xs-4 col-md-3 col-xs-offset-1" style="">Were you a PM?</p>
                    <input type="checkbox" class="col-xs-1" [(ngModel)] = 'agency.main.isPM' style="">
                    <div class="col-xs-1" *ngIf='agency.main.isPM'>
                      <div class="" style="text-align: left">Score:</div>
                      <input type="number" min='1' max='5' name="" value="" [(ngModel)]='agency.main.pmScore' *ngIf='agency.main.isPM'>
                    </div>
                    <div class="col-xs-5 col-md-6">
                      <textarea class="left" rows="2" placeholder="Description:" [(ngModel)] = 'agency.main.pmDescription' *ngIf='agency.main.isPM' [ngClass]="{'empty-field': agency.main.pmScore >= 4 && agency.main.pmDescription.length < 300}"></textarea>
                    </div>
                  </div>
                  <div class="col-xs-12" style="height: 50px">
                    <p class="col-xs-4 col-md-3 col-xs-offset-1" style="">Were you a KO?</p>
                    <input type="checkbox" class="col-xs-1" [(ngModel)] = 'agency.main.isKO' style="">
                    <div class="col-xs-1" *ngIf='agency.main.isKO'>
                      <div class="" style="text-align: left">Score:</div>
                      <input type="number" min='1' max='5' name="" value="" [(ngModel)]='agency.main.koScore' *ngIf='agency.main.isKO'>
                    </div>
                    <div class="col-xs-5 col-md-6">
                      <textarea class="left" rows="2" placeholder="Description:" [(ngModel)] = 'agency.main.koDescription' *ngIf='agency.main.isKO' [ngClass]="{'empty-field': agency.main.koScore >= 4 && agency.main.koDescription.length < 300}"></textarea>
                    </div>
                  </div>
                  <div class="" *ngIf='agency.offices.length < 1'>
                    <p class="col-xs-8 vertically-centered" style="text-align: right">Did you work for a subagency?</p>
                    <button class="col-xs-4" (click)="addOffice(agency)">Yes</button>
                  </div>
                  <div class="" *ngIf='agency.offices.length > 0'>
                    <div class="" *ngFor='let office of agency.offices; let i = index; trackBy:customTrackBy' style="position: relative">
                      <div class="col-xs-12" style="position: relative">
                        <p class="col-md-3 col-xs-5 col-xs-offset-1 vertically-centered">Subagency</p>
                        <div class="autocomplete-form">
                          <input ngui-auto-complete class="col-md-8 col-xs-6" placeholder="Must match an existing subagency" [(ngModel)] = 'office.title' [source]='findSubAgencies(agency.main.title)' auto-select-first-item='true' [ngClass]="{'empty-field': subagencyValidCheck(agency.main.title, office.title) == false}">
                        </div>
                        <button class="tiny-button-tools" (click)="deleteOffice(agency, i)" style="right: 16px; top: 11px;"><div class="tiny-button-text">X</div></button>
                        <div class="col-xs-12" style="height: 50px">
                          <p class="col-xs-4 col-md-3 col-xs-offset-1" style="">Were you a PM?</p>
                          <input type="checkbox" class="col-xs-1" [(ngModel)] = 'office.isPM' style="">
                          <div class="col-xs-1" *ngIf='office.isPM'>
                            <div class="" style="text-align: left">Score:</div>
                            <input type="number" min='1' max='5' name="" value="" [(ngModel)]='office.pmScore' *ngIf='office.isPM'>
                          </div>
                          <div class="col-xs-5 col-md-6">
                            <textarea class="left" rows="2" placeholder="Description:" [(ngModel)] = 'office.pmDescription' *ngIf='office.isPM' [ngClass]="{'empty-field': office.pmScore >= 4 && office.pmDescription.length < 300}"></textarea>
                          </div>
                        </div>
                        <div class="col-xs-12" style="height: 50px">
                          <p class="col-xs-4 col-md-3 col-xs-offset-1" style="">Were you a KO?</p>
                          <input type="checkbox" class="col-xs-1" [(ngModel)] = 'office.isKO' style="">
                          <div class="col-xs-1" *ngIf='office.isKO'>
                            <div class="" style="text-align: left">Score:</div>
                            <input type="number" min='1' max='5' name="" value="" [(ngModel)]='office.koScore' *ngIf='office.isKO'>
                          </div>
                          <div class="col-xs-5 col-md-6">
                            <textarea class="left empty-field" rows="2" placeholder="Description:" [(ngModel)] = 'office.koDescription' *ngIf='office.isKO' [ngClass]="{'empty-field': office.koScore >= 4 && office.koDescription.length < 300}"></textarea>
                          </div>
                        </div>
                      </div>
                    </div>
                    <button class="col-xs-4 col-xs-offset-8" (click)="addOffice(agency)">Add Subagency</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xs-8 col-xs-offset-2">
      <button class="col-xs-12 col-xs-offset-0 col-md-4 col-md-offset-4" (click)="addJob()">Add Job</button>
    </div>
  </div>

  <div class="career col-xs-12 clear" *ngIf='this.currentUser.resumeText'>
    <div class="div-title col-xs-12">
      <img src="./assets/img/profile/capabilities-1.png">
      <p>SKILLS</p>
      <div ></div>
    </div>

    <p style="text-align: center">Use the right panel to search the tools database, and click one to add it to your list</p>
    <div class="col-xs-6 text-center text-container" style="padding-top: 15px">
      <p>Your Skills</p>
      <div class="tool-list-box">
        <div class="">
          <div class="tool-list-item" *ngFor='let tool of this.currentUser.foundTools; let i = index; trackBy:customTrackBy'>
            {{tool.title}}
            <button class="tiny-button-tools" (click)="deleteTool(i)"><div class="tiny-button-text">x</div></button>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xs-6 text-center text-container" style="padding-top: 15px">
      <p>(this is slow right now, please be patient)</p>
      <input type="text" style="width: 100%" [(ngModel)] = 'this.toolSearch' (ngModelChange)="updateToolList($event)" >
      <div class="tool-search-box">
        <div class="" *ngIf='this.allTools.length < 1'>
          <p>We're still retrieving the tools. Wait a moment...</p>
        </div>
        <div class="" *ngIf='this.allTools.length > 0'>
          <div class="no-tool-found" *ngIf='this.toolSearch.length >= 1 && this.filteredTools.length == 0 && this.filteredToolsFromProfile.length == 0 && !this.toolSubmitted' >
            <p>No matches found. Submit {{this.toolSearch}} as a new tool?</p>
            <button class="btn btn-primary btn-block" type="button" name="button" (click)='submitNewTool(this.toolSearch)'>Submit</button>
          </div>
          <div class="no-tool-found" *ngIf='this.toolSearch.length >= 1 && this.filteredTools.length == 0 && this.toolSubmitted' >
            <p>{{this.toolSearch}} has been submitted. If it's approved we'll add it to the list!</p>
          </div>
          <div class="" *ngIf='this.toolSearch.length >= 1'>
            <div class="" *ngFor='let tool of this.filteredToolsFromProfile; let i = index; trackBy:customTrackBy'>
              <div class="tool-search-item" *ngIf='toolIsNotListedAlready(tool)' (click)='findAndAddTool(tool)'>
                <p>{{tool.title}}</p>
              </div>
            </div>
          </div>
          <div class="" *ngIf='this.toolSearch.length >= 1'>
            <div class="" *ngFor='let tool of this.filteredTools; let i = index; trackBy:customTrackBy'>
              <div class="tool-search-item" *ngIf='toolIsValid(tool)' (click)='addTool(this.filteredTools[i])'>
                <p>{{tool.title}}</p>
              </div>
            </div>
          </div>
          <div class="" *ngIf='this.toolSearch.length >= 1 && !this.toolSubmitted' >
            <div class="no-tool-found" *ngIf='this.filteredTools.length > 0 || this.filteredToolsFromProfile.length > 0'>
              <p>Can't find what you're looking for? Submit {{this.toolSearch}} as a new tool.</p>
              <button class="btn btn-primary btn-block" type="button" name="button" (click)='submitNewTool(this.toolSearch)'>Submit</button>
            </div>
          </div>
          <div class="" *ngIf='this.toolSearch.length >= 1 && this.toolSubmitted' >
            <div class="no-tool-found" *ngIf='this.filteredTools.length > 0 || this.filteredToolsFromProfile.length > 0'>
              <p>{{this.toolSearch}} has been submitted. If it's approved we'll add it to the list!</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xs-8">
      <canvas baseChart
      [datasets]="toolChartDatas"
      [labels]="toolChartLabels"
      [options]="{ scaleShowVerticalLines: true, responsive: true, scales: { yAxes: [{ticks: {beginAtZero: true }}]} }"
      [legend]="false"
      [chartType]="'bar'"></canvas>
    </div>
    <div class="col-xs-4 score-panel-outer">
      <p style="text-align: center">You can assign points based on your Professional Points, calculated from your job and school experience and your certifications</p>
      <p style="text-align: center">You have {{this.availablePoints}} points left out of a total {{this.professionalPoints}}</p>
      <div class="score-panel">
        <div class="" *ngFor='let t of this.currentUser.foundTools; let i = index'>
          <div class="col-xs-8 vertically-centered">
            {{t.title}}
          </div>
          <div class="col-xs-4">
            <input class="col-xs-12" type="number" name="" value="" min=0 max={{maxToolScores[i]}} [(ngModel)]='t.score' (ngModelChange)='calculateAvailablePoints(t, i); calculateSkillChart()'>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="career col-xs-12 clear" *ngIf='!this.currentUser.resumeText'>
    <div class="div-title col-xs-12">
      <img src="./assets/img/profile/capabilities-1.png">
      <p>SKILLS</p>
      <div ></div>
    </div>
    <p>Hi! This profile doesn't have the full resume text saved so this stuff won't work. If you make a new profile it should all be good!</p>
  </div>

  <div class="career col-xs-12">
    <div class="div-title col-xs-12">
      <p>INTERESTS</p>
      <div ></div>
    </div>
    <div class="col-xs-12">
      <div class="text-container text-left" [style.height] = "'300px'">
        <textarea class="col-xs-12 interests" [(ngModel)] = 'this.currentUser.interest'></textarea>
      </div>
    </div>
  </div>

  <div class="availability col-xs-12 clear">
      <div class="div-title col-xs-12">
          <img src="./assets/img/profile/availability.png">
          <p>AVAILABILITY</p>
          <div ></div>
      </div>
      <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 text-container">
          <app-color-comment-box color='#7f7f7f' text='unavailable' class="col-xs-12 col-sm-6 col-md-6"></app-color-comment-box>
          <app-color-comment-box color='#0b6ec1' text='available' class="col-xs-12 col-sm-6 col-md-6"></app-color-comment-box>
      </div>
      <div class="col-xs-12">
        <div class="available-bar">
          <div *ngFor="let index of this.currentUser.availability; let i = index">
            <div class="" class="div-available available" *ngIf='index.available' (click) = 'index.available = !index.available'></div>
            <div class="" class="div-available unavailable" *ngIf='!index.available' (click) = 'index.available = !index.available'></div>
          </div><br>
          <p *ngFor="let date of availabilityData.dates" class="div-available-date">{{date}}</p>
        </div>

        <!-- <app-availablebar [values] = 'availabilityData.values' [dates] = 'availabilityData.dates' [edit] = true></app-availablebar> -->
      </div>
  </div>
  <div class="col-xs-6 col-xs-offset-3" style="margin-bottom: 1%">
    <button class="btn btn-primary btn-block" (click)="updateProfile(this.currentUser)" *ngIf='this.fieldsFilled && this.allTools.length > 0'>Save Changes</button>
    <button class="btn btn-primary btn-block" style="background-color: red" *ngIf='!this.fieldsFilled'>Page Unfinished</button>
    <button class="btn btn-primary btn-block" style="background-color: red" *ngIf='this.fieldsFilled && this.allTools.length < 1'>Please wait...</button>
  </div>
  <br>

</div>
